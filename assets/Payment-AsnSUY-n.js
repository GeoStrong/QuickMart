import{t as T,r as P,x as Ie,w as je,u as Ae,i as ne,q as Ee,g as Fe,s as Pe,E as ke,F as Me,G,I as ie,j as x,a as De,c as Oe,J as k,o as ue,K as Re,L as Te,b as Be}from"./index-kBEPsdM1.js";function le(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]]);return a}var Y;(function(e){e.event="event",e.props="prop"})(Y||(Y={}));function O(){}function _e(e){var t,a=void 0;return function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return t&&n.length===t.length&&n.every(function(l,d){return l===t[d]})||(t=n,a=e.apply(void 0,n)),a}}function $(e){return!!(e||"").match(/\d/)}function H(e){return e==null}function Le(e){return typeof e=="number"&&isNaN(e)}function $e(e){return H(e)||Le(e)||typeof e=="number"&&!isFinite(e)}function Ke(e){var t=P.useRef(e);t.current=e;var a=P.useRef(function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return t.current.apply(t,n)});return a.current}function oe(e,t){return Array(t+1).join(e)}function qe(e){var t=e+"",a=t[0]==="-"?"-":"";a&&(t=t.substring(1));var n=t.split(/[eE]/g),r=n[0],l=n[1];if(l=Number(l),!l)return a+r;r=r.replace(".","");var d=1+l,v=r.length;return d<0?r="0."+oe("0",Math.abs(d))+r:d>=v?r=r+oe("0",d-v):r=(r.substring(0,d)||"0")+"."+r.substring(d),a+r}function Z(e,t){if(e.value=e.value,e!==null){if(e.createTextRange){var a=e.createTextRange();return a.move("character",t),a.select(),!0}return e.selectionStart||e.selectionStart===0?(e.focus(),e.setSelectionRange(t,t),!0):(e.focus(),!1)}}var Ue=_e(function(e,t){for(var a=0,n=0,r=e.length,l=t.length;e[a]===t[a]&&a<r;)a++;for(;e[r-1-n]===t[l-1-n]&&l-n>a&&r-n>a;)n++;return{from:{start:a,end:r-n},to:{start:a,end:l-n}}});function Ge(e,t,a){return Math.min(Math.max(e,t),a)}function X(e){return Math.max(e.selectionStart,e.selectionEnd)}function Ye(){return typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function He(e){return{from:{start:0,end:0},to:{start:0,end:e.length},lastValue:""}}function fe(e,t){return e===void 0&&(e=" "),typeof e=="string"?e:e[t]||" "}function ze(e){var t=e.currentValue,a=e.formattedValue,n=e.currentValueIndex,r=e.formattedValueIndex;return t[n]===a[r]}function Je(e,t,a,n,r,l,d){d===void 0&&(d=ze);var v=r.findIndex(function(A){return A}),g=e.slice(0,v);!t&&!a.startsWith(g)&&(t=g,a=g+a,n=n+g.length);for(var y=a.length,C=e.length,p={},s=new Array(y),f=0;f<y;f++){s[f]=-1;for(var o=0,V=C;o<V;o++){var h=d({currentValue:a,lastValue:t,formattedValue:e,currentValueIndex:f,formattedValueIndex:o});if(h&&p[o]!==!0){s[f]=o,p[o]=!0;break}}}for(var m=n;m<y&&(s[m]===-1||!l(a[m]));)m++;var F=m===y||s[m]===-1?C:s[m];for(m=n-1;m>0&&s[m]===-1;)m--;var N=m===-1||s[m]===-1?0:s[m]+1;return N>F?F:n-N<F-n?N:F}function z(e,t,a,n){var r=e.length;if(t=Ge(t,0,r),n==="left"){for(;t>=0&&!a[t];)t--;t===-1&&(t=a.indexOf(!0))}else{for(;t<=r&&!a[t];)t++;t>r&&(t=a.lastIndexOf(!0))}return t===-1&&(t=r),t}function We(e){for(var t=Array.from({length:e.length+1}).map(function(){return!0}),a=0,n=t.length;a<n;a++)t[a]=!!($(e[a])||$(e[a-1]));return t}function Qe(e,t,a,n,r,l){l===void 0&&(l=O);var d=Ke(function(o,V){var h,m;return $e(o)?(m="",h=""):typeof o=="number"||V?(m=typeof o=="number"?qe(o):o,h=n(m)):(m=r(o,void 0),h=n(m)),{formattedValue:h,numAsString:m}}),v=P.useState(function(){return d(H(e)?t:e,a)}),g=v[0],y=v[1],C=function(o,V){o.formattedValue!==g.formattedValue&&y({formattedValue:o.formattedValue,numAsString:o.value}),l(o,V)},p=e,s=a;H(e)&&(p=g.numAsString,s=!0);var f=d(p,s);return P.useMemo(function(){y(f)},[f.formattedValue]),[g,C]}function Xe(e){return e.replace(/[^0-9]/g,"")}function Ze(e){return e}function et(e){var t=e.type;t===void 0&&(t="text");var a=e.displayType;a===void 0&&(a="input");var n=e.customInput,r=e.renderText,l=e.getInputRef,d=e.format;d===void 0&&(d=Ze);var v=e.removeFormatting;v===void 0&&(v=Xe);var g=e.defaultValue,y=e.valueIsNumericString,C=e.onValueChange,p=e.isAllowed,s=e.onChange;s===void 0&&(s=O);var f=e.onKeyDown;f===void 0&&(f=O);var o=e.onMouseUp;o===void 0&&(o=O);var V=e.onFocus;V===void 0&&(V=O);var h=e.onBlur;h===void 0&&(h=O);var m=e.value,F=e.getCaretBoundary;F===void 0&&(F=We);var N=e.isValidInputCharacter;N===void 0&&(N=$);var A=e.isCharacterSame,M=le(e,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),K=Qe(m,g,!!y,d,v,C),ee=K[0],S=ee.formattedValue,q=ee.numAsString,ce=K[1],U=P.useRef({formattedValue:S,numAsString:q}),te=function(i,u){U.current={formattedValue:i.formattedValue,numAsString:i.value},ce(i,u)},re=P.useState(!1),de=re[0],ve=re[1],B=P.useRef(null),R=P.useRef({setCaretTimeout:null,focusTimeout:null});P.useEffect(function(){return ve(!0),function(){clearTimeout(R.current.setCaretTimeout),clearTimeout(R.current.focusTimeout)}},[]);var me=d,J=function(i,u){var c=parseFloat(u);return{formattedValue:i,value:u,floatValue:isNaN(c)?void 0:c}},D=function(i,u,c){i.selectionStart===0&&i.selectionEnd===i.value.length||(Z(i,u),R.current.setCaretTimeout=setTimeout(function(){i.value===c&&i.selectionStart!==i.selectionEnd&&Z(i,u)},0))},_=function(i,u,c){return z(i,u,F(i),c)},W=function(i,u,c){var w=F(u),I=Je(u,S,i,c,w,N,A);return I=z(u,I,w),I},ge=function(i){var u=i.formattedValue;u===void 0&&(u="");var c=i.input,w=i.setCaretPosition;w===void 0&&(w=!0);var I=i.source,b=i.event,j=i.numAsString,E=i.caretPos;if(c){if(E===void 0&&w){var L=i.inputValue||c.value,Q=X(c);c.value=u,E=W(L,u,Q)}c.value=u,w&&E!==void 0&&D(c,E,u)}u!==S&&te(J(u,j),{event:b,source:I})};P.useEffect(function(){var i=U.current,u=i.formattedValue,c=i.numAsString;S!==u&&(S!==q||u!==c)&&te(J(S,q),{event:void 0,source:Y.props})},[S,q]);var he=B.current?X(B.current):void 0,pe=typeof window<"u"?P.useLayoutEffect:P.useEffect;pe(function(){var i=B.current;if(S!==U.current.formattedValue&&i){var u=W(U.current.formattedValue,S,he);i.value=S,D(i,u,S)}},[S]);var xe=function(i,u,c){var w=Ue(S,i),I=Object.assign(Object.assign({},w),{lastValue:S}),b=v(i,I),j=me(b);if(b=v(j,void 0),p&&!p(J(j,b))){var E=u.target,L=X(E),Q=W(i,S,L);return E.value=S,D(E,Q,S),!1}return ge({formattedValue:j,numAsString:b,inputValue:i,event:u,source:c,setCaretPosition:!0,input:u.target}),!0},ye=function(i){var u=i.target,c=u.value,w=xe(c,i,Y.event);w&&s(i)},Ce=function(i){var u=i.target,c=i.key,w=u.selectionStart,I=u.selectionEnd,b=u.value;b===void 0&&(b="");var j;if(c==="ArrowLeft"||c==="Backspace"?j=Math.max(w-1,0):c==="ArrowRight"?j=Math.min(w+1,b.length):c==="Delete"&&(j=w),j===void 0||w!==I){f(i);return}var E=j;if(c==="ArrowLeft"||c==="ArrowRight"){var L=c==="ArrowLeft"?"left":"right";E=_(b,j,L),E!==j&&i.preventDefault()}else c==="Delete"&&!N(b[j])?E=_(b,j,"right"):c==="Backspace"&&!N(b[j])&&(E=_(b,j,"left"));E!==j&&D(u,E,b),i.isUnitTestRun&&D(u,E,b),f(i)},be=function(i){var u=i.target,c=u.selectionStart,w=u.selectionEnd,I=u.value;if(I===void 0&&(I=""),c===w){var b=_(I,c);b!==c&&D(u,b,I)}o(i)},Ve=function(i){i.persist&&i.persist();var u=i.target;B.current=u,R.current.focusTimeout=setTimeout(function(){var c=u.selectionStart,w=u.selectionEnd,I=u.value;I===void 0&&(I="");var b=_(I,c);b!==c&&!(c===0&&w===I.length)&&D(u,b,I),V(i)},0)},Ne=function(i){B.current=null,clearTimeout(R.current.focusTimeout),clearTimeout(R.current.setCaretTimeout),h(i)},Se=de&&Ye()?"numeric":void 0,ae=Object.assign({inputMode:Se},M,{type:t,value:S,onChange:ye,onKeyDown:Ce,onMouseUp:be,onFocus:Ve,onBlur:Ne});if(a==="text")return r?T.createElement(T.Fragment,null,r(S,M)||null):T.createElement("span",Object.assign({},M,{ref:l}),S);if(n){var we=n;return T.createElement(we,Object.assign({},ae,{ref:l}))}return T.createElement("input",Object.assign({},ae,{ref:l}))}function tt(e,t){var a=t.format,n=t.allowEmptyFormatting,r=t.mask,l=t.patternChar;if(l===void 0&&(l="#"),e===""&&!n)return"";for(var d=0,v=a.split(""),g=0,y=a.length;g<y;g++)a[g]===l&&(v[g]=e[d]||fe(r,d),d+=1);return v.join("")}function rt(e,t,a){t===void 0&&(t=He(e));var n=a.format,r=a.patternChar;r===void 0&&(r="#");var l=t.from,d=t.to,v=t.lastValue;v===void 0&&(v="");var g=function(h){return n[h]===r},y=function(h,m){for(var F="",N=0;N<h.length;N++)g(m+N)&&$(h[N])&&(F+=h[N]);return F},C=function(h){return h.replace(/[^0-9]/g,"")};if(!n.match(/\d/))return C(e);if(v===""&&e.length===n.length){for(var p="",s=0;s<e.length;s++)if(g(s))$(e[s])&&(p+=e[s]);else if(e[s]!==n[s])return C(e);return p}var f=v.substring(0,l.start),o=e.substring(d.start,d.end),V=v.substring(l.end);return""+y(f,0)+C(o)+y(V,l.end)}function at(e,t){var a=t.format,n=t.mask,r=t.patternChar;r===void 0&&(r="#");var l=Array.from({length:e.length+1}).map(function(){return!0}),d=0,v=-1,g={};a.split("").forEach(function(s,f){var o=void 0;s===r&&(d++,o=fe(n,d-1),v===-1&&e[f]===o&&(v=f)),g[f]=o});for(var y=function(s){return a[s]===r&&e[s]!==g[s]},C=0,p=l.length;C<p;C++)l[C]=C===v||y(C)||y(C-1);return l[a.indexOf(r)]=!0,l}function nt(e){var t=e.mask;if(t){var a=t==="string"?t:t.toString();if(a.match(/\d/g))throw new Error("Mask "+t+" should not contain numeric character;")}}function it(e,t){return e===""?!0:!(t!=null&&t.match(/\d/))&&typeof e=="string"&&(!!e.match(/^\d+$/)||e==="")}function ut(e){e.mask,e.allowEmptyFormatting;var t=e.format,a=e.inputMode;a===void 0&&(a="numeric");var n=e.onKeyDown;n===void 0&&(n=O);var r=e.patternChar;r===void 0&&(r="#");var l=e.value,d=e.defaultValue,v=e.valueIsNumericString,g=le(e,["mask","allowEmptyFormatting","format","inputMode","onKeyDown","patternChar","value","defaultValue","valueIsNumericString"]);nt(e);var y=function(o){return at(o,e)},C=function(o){var V=o.key,h=o.target,m=h.selectionStart,F=h.selectionEnd,N=h.value;if(m!==F){n(o);return}var A=m;if(V==="Backspace"||V==="Delete"){var M="right";if(V==="Backspace"){for(;A>0&&t[A-1]!==r;)A--;M="left"}else{for(var K=t.length;A<K&&t[A]!==r;)A++;M="right"}A=z(N,A,y(N),M)}else t[A]!==r&&V!=="ArrowLeft"&&V!=="ArrowRight"&&(A=z(N,A+1,y(N),"right"));A!==m&&Z(h,A),n(o)},p=H(l)?d:l,s=v??it(p,t),f=Object.assign(Object.assign({},e),{valueIsNumericString:s});return Object.assign(Object.assign({},g),{value:l,defaultValue:d,valueIsNumericString:s,inputMode:a,format:function(o){return tt(o,f)},removeFormatting:function(o,V){return rt(o,V,f)},getCaretBoundary:y,onKeyDown:C})}function se(e){var t=ut(e);return T.createElement(et,Object.assign({},t))}const st=()=>{const e=Ie(),t=je(),{getProfileSettings:a}=Ae(),{id:n}=ne(f=>f.account),{paymentMethod:r}=ne(f=>f.settings),[l,d]=P.useState(!1),v=Ee(),{isScreenMobile:g}=Be(),{originPath:y}=Fe();P.useEffect(()=>{(async()=>{const o=await a(n,"payment method");e(ie.setPaymentMethod(o))})()},[e,a,n]),Pe(()=>{v(!0)});const C=(f=0)=>{const o=new Date,V=o.getFullYear(),h=o.getMonth()+1,m=o.getDate()<10?`0${o.getDate()}`:`${o.getDate()}`;return`${+V+f}-0${h}-${m}`},p=ke({initialValues:{cardName:(r==null?void 0:r.cardName)||"",cardNumber:(r==null?void 0:r.cardNumber)||"",expiration:(r==null?void 0:r.expiration)||"",CVV:(r==null?void 0:r.CVV)||""},validationSchema:Me({cardName:G().required("Required").min(3,"Must be 3 characters or more").max(20,"Must be 20 characters or less"),cardNumber:G().required("Required").test("cardNumber","Card number must be 16 characters",f=>f.split(" ").join("").length===16),expiration:G().required("Required").test("expiration","Card expiration date must be greater than today",f=>f>C()),CVV:G().required("Required")}),onSubmit:f=>{t(f,{method:"PATCH"}),e(ie.setPaymentMethod(f)),d(!0)}}),s=f=>p.errors[f]&&p.touched[f];return x.jsxs(De,{children:[g&&x.jsx(Oe,{page:"Payment Method"}),x.jsxs(k,{className:"d-flex flex-column mt-6",onSubmit:p.handleSubmit,children:[x.jsxs(k.Group,{className:"mb-2",children:[x.jsxs(k.Label,{className:"fw-medium",children:["Card Holder Name"," ",s("cardName")&&x.jsx("span",{className:"text-danger",children:" * "})]}),x.jsx(k.Control,{className:`p-3 ${s("cardName")?"border-danger":""}`,type:"text",id:"cardName",placeholder:"Enter card holder name",...p.getFieldProps("cardName")})]}),x.jsxs(k.Group,{className:"mb-2",children:[x.jsxs(k.Label,{className:"fw-medium",children:["Card Number"," ",s("cardNumber")&&x.jsx("span",{className:"text-danger",children:" * "})]}),x.jsx(se,{id:"cardNumber",className:`p-3 ${s("cardNumber")?"border-danger":""}`,format:"#### #### #### ####",placeholder:"4111 1111 1111 1111",customInput:k.Control,...p.getFieldProps("cardNumber")})]}),x.jsxs("div",{className:"d-flex gap-2",children:[x.jsxs(k.Group,{className:"w-50",children:[x.jsxs(k.Label,{className:"fw-medium",children:["Expiration"," ",s("expiration")&&x.jsx("span",{className:"text-danger",children:" * "})]}),x.jsx(k.Control,{id:"expiration",className:`p-3 ${s("expiration")?"border-danger":""}`,type:"date",placeholder:"DD/MM/YY",min:C(),max:C(5),...p.getFieldProps("expiration")})]}),x.jsxs(k.Group,{className:"mb-3 w-50",children:[x.jsxs(k.Label,{className:"fw-medium",children:["CVV"," ",s("CVV")&&x.jsx("span",{className:"text-danger",children:" * "})]}),x.jsx(se,{id:"CVV",className:`p-3 ${s("CVV")?"border-danger":""}`,format:"###",placeholder:"123",customInput:k.Control,...p.getFieldProps("CVV")})]})]}),x.jsx(ue,{variant:"dark",className:"p-3 align-self-md-end px-md-5 rounded-3 py-3 d-flex align-items-center justify-content-center gap-2",type:"submit",onClick:()=>p.setFieldValue("intent","payment"),children:"Save"})]}),x.jsxs(Re,{title:"Your payment method has been saved",show:l,onClose:()=>d(!1),children:[x.jsx(ue,{variant:"white",onClick:()=>d(!1),children:"Close"}),x.jsx(Te,{to:`/${y}/profile`,className:"btn btn-dark",children:"Go to profile"})]})]})};export{st as default};
