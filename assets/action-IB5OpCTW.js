import{a6 as f,a5 as A}from"./index-nL0kgY8s.js";const r="https://quickmart-21bf3-default-rtdb.firebaseio.com/users",i="?auth=LqYQArvL3uTpuLrsicJHxuDbzsXH2DfsXZosxsi2",u=async(s,a)=>{const t={};return a.forEach(n=>t[n]=s.get(n)),t},m=async(s,a)=>{const t=await fetch(s,a);if(!t.ok)throw A({message:"Something went wrong"},{status:500});return{data:await t.json()}},d=(s,a,t)=>s?a:[{message:t},{status:401}],D=(s,a)=>Object.values(s.data).filter(t=>{if(t.email===a.email&&t.password===a.password)return localStorage.setItem("localAccountId",t.id),t}),b=(s,a)=>Object.values(s).filter(t=>{if(t.email===a.email)return localStorage.setItem("localAccountId",t.id),t}),y=async(s,a,t)=>(await m(`${r}/user_${s}.json${i}`,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),f("/QuickMart/authentication/login/success")),v=s=>async({request:a})=>{const t=await a.formData(),n=t.get("intent"),w=n==="login",g=n==="reset",h=n==="new password",p=n==="signup";let e,o=[`${r}.json${i}`],c;const $=await m(o);if((w||g)&&(e=await u(t,["email","password"])),h&&(e=await u(t,["password"]),o=[`${r}/user_${s}.json${i}`]),p){const j=Math.floor(Math.random()*100);e=await u(t,["fullName","email","password"]),!b($.data,e).length>0?o=[`${r}/user_${j}.json${i}`,{method:a.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({id:j,...e})}]:c="Account already exist"}const{data:l}=await m(...o);if(w)return d(D($,e).length>0,f("/QuickMart"),"Invalid email or password");if(g)return d(b(l,e).length!==0,f("/QuickMart/authentication/login/email verification"),"Invalid email");if(h)return d(l.password!==e.password,y(s,a.method,e),"New password cannot be the same as your old password");if(p)return c?[{message:c},{status:401}]:l};export{v as action};
