import{accountUrl as i,authToken as c}from"./config-h-6_80oT.js";import{ah as m,ai as A}from"./index-imR5RE01.js";const d=async(a,e)=>{const t={};return e.forEach(n=>t[n]=a.get(n)),t},p=async(a,e)=>{const t=await fetch(a,e);if(!t.ok)throw A({message:"Something went wrong"},{status:500});return{data:await t.json()}},u=(a,e,t)=>a?e:[{message:t},{status:401}],P=(a,e)=>Object.values(a.data).filter(t=>{if(t.email===e.email&&t.password===e.password)return localStorage.setItem("localAccountId",t.id),t}),C=(a,e)=>Object.values(a).filter(t=>{if(t.email===e.email)return localStorage.setItem("localAccountId",t.id),t}),_=async(a,e,t)=>(await p(`${i}/user_${a}.json${c}`,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),m("/QuickMart/authentication/login/success")),D=a=>async({request:e})=>{const t=await e.formData(),n=t.get("intent"),f=n==="login",g=n==="reset",h=n==="new password",w=n==="signup",$=n==="address",y=n==="payment",j=n==="add to cart",v=n==="remove item from cart",I=n==="add to favorite",S=n==="remove item from favorite";let o,s=[`${i}.json${c}`],l;const N=await p(s);if((f||g)&&(o=await d(t,["email","password"])),h&&(o=await d(t,["password"]),s=[`${i}/user_${a}.json${c}`]),w){const r=crypto.getRandomValues(new Uint32Array(1))[0];o=await d(t,["fullName","email","password"]),!C(N.data,o).length>0?s=[`${i}/user_${r}.json${c}`,{method:e.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r,...o})}]:l="Account already exist"}if($&&(o=await d(t,["fullName","province","city","street","postalCode","phoneNumber"]),s=[`${i}/user_${a}.json${c}`,{method:e.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({"shipping address":o})}]),y&&(o=await d(t,["cardName","cardNumber","expiration","CVV"]),s=[`${i}/user_${a}.json${c}`,{method:e.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({"payment method":o})}]),j||I){const r=j?"cart":"favorite";o=JSON.parse(t.get("product")),s=[`${i}/user_${a}/${r}/${r}_${o.id}.json${c}`,{method:e.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({...o})}]}if(v||S){const r=v?"cart":"favorite";s=[`${i}/user_${a}/${r}/${r}_${t.get("itemId")}.json${c}`,{method:e.method,headers:{"Content-Type":"application/json"}}]}const{data:b}=await p(...s);return f?u(P(N,o).length>0,m("/QuickMart"),"Invalid email or password"):g?u(C(b,o).length!==0,m("/QuickMart/authentication/login/email verification"),"Invalid email"):h?u(b.password!==o.password,_(a,e.method,o),"New password cannot be the same as your old password"):w?l?[{message:l},{status:401}]:m("/QuickMart/authentication/signup/email verification"):$||y?!0:[{message:"Something went wrong"},{status:500}]};export{D as action};
