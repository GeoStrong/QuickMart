import{X as $}from"./index-2KJDp6CU.js";const d="https://quickmart-21bf3-default-rtdb.firebaseio.com/users",u="?auth=LqYQArvL3uTpuLrsicJHxuDbzsXH2DfsXZosxsi2",f=async(e,s)=>{const t={};return s.forEach(n=>t[n]=e.get(n)),t},D=async(e,s)=>{const t=await fetch(e,s);if(!t.ok)throw $({message:"Something went wrong"},{status:500});return{data:await t.json()}},m=(e,s,t)=>e?s:[{message:t},{status:401}],w=(e,s)=>Object.values(e).filter(t=>t.email===s.email),v=(e,s)=>async({request:t})=>{const n=await t.formData(),i=n.get("intent"),p=i==="login",g=i==="reset",h=i==="new password",y=i==="signup";let a,c=[`${d}.json${u}`],l;const b=await D(c);if((p||g)&&(a=await f(n,["email","password"])),h&&(a=await f(n,["password"]),c=[`${d}/user_${e}.json${u}`,{method:t.method,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}]),y){const r=Math.floor(Math.random()*100);a=await f(n,["fullName","email","password"]),!w(b.data,a).length>0?c=[`${d}/user_${r}.json${u}`,{method:t.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r,...a})}]:l="Account already exist"}const{data:o}=await D(...c),j=Object.values(b.data).filter(r=>r.email===a.email&&r.password===a.password);if(p)return m(j.length>0,j[0],"Invalid email or password");if(g)return m(w(o,a).length!==0,w(o,a)[0],"Invalid email");if(h)return m(o.password!==s,o,"New password cannot be the same as your old password");if(y)return l?[{message:l},{status:401}]:o};export{v as action};
