import{accountUrl as i,authToken as r}from"./config-S3oXEhB2.js";import{a8 as l,a9 as A}from"./index-kBEPsdM1.js";const c=async(e,a)=>{const t={};return a.forEach(s=>t[s]=e.get(s)),t},m=async(e,a)=>{const t=await fetch(e,a);if(!t.ok)throw A({message:"Something went wrong"},{status:500});return{data:await t.json()}},u=(e,a,t)=>e?a:[{message:t},{status:401}],P=(e,a)=>Object.values(e.data).filter(t=>{if(t.email===a.email&&t.password===a.password)return localStorage.setItem("localAccountId",t.id),t}),b=(e,a)=>Object.values(e).filter(t=>{if(t.email===a.email)return localStorage.setItem("localAccountId",t.id),t}),S=async(e,a,t)=>(await m(`${i}/user_${e}.json${r}`,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),l("/QuickMart/authentication/login/success")),D=e=>async({request:a})=>{const t=await a.formData(),s=t.get("intent"),p=s==="login",g=s==="reset",f=s==="new password",w=s==="signup",h=s==="address",y=s==="payment";let n,o=[`${i}.json${r}`],d;const $=await m(o);if((p||g)&&(n=await c(t,["email","password"])),f&&(n=await c(t,["password"]),o=[`${i}/user_${e}.json${r}`]),w){const N=crypto.getRandomValues(new Uint32Array(1))[0];n=await c(t,["fullName","email","password"]),!b($.data,n).length>0?o=[`${i}/user_${N}.json${r}`,{method:a.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({id:N,...n})}]:d="Account already exist"}h&&(n=await c(t,["fullName","province","city","street","postalCode","phoneNumber"]),o=[`${i}/user_${e}.json${r}`,{method:a.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({"shipping address":n})}]),y&&(n=await c(t,["cardName","cardNumber","expiration","CVV"]),o=[`${i}/user_${e}.json${r}`,{method:a.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({"payment method":n})}]);const{data:j}=await m(...o);return p?u(P($,n).length>0,l("/QuickMart"),"Invalid email or password"):g?u(b(j,n).length!==0,l("/QuickMart/authentication/login/email verification"),"Invalid email"):f?u(j.password!==n.password,S(e,a.method,n),"New password cannot be the same as your old password"):w?d?[{message:d},{status:401}]:l("/QuickMart/authentication/signup/email verification"):h||y?!0:[{message:"Something went wrong"},{status:500}]};export{D as action};
