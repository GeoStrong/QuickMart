import{a6 as i,a5 as A}from"./index-2uLOTj64.js";const r="https://quickmart-21bf3-default-rtdb.firebaseio.com/users",c="?auth=LqYQArvL3uTpuLrsicJHxuDbzsXH2DfsXZosxsi2",u=async(e,a)=>{const t={};return a.forEach(n=>t[n]=e.get(n)),t},f=async(e,a)=>{const t=await fetch(e,a);if(!t.ok)throw A({message:"Something went wrong"},{status:500});return{data:await t.json()}},d=(e,a,t)=>e?a:[{message:t},{status:401}],D=(e,a)=>Object.values(e.data).filter(t=>{if(t.email===a.email&&t.password===a.password)return localStorage.setItem("localAccountId",t.id),t}),b=(e,a)=>Object.values(e).filter(t=>{if(t.email===a.email)return localStorage.setItem("localAccountId",t.id),t}),v=async(e,a,t)=>(await f(`${r}/user_${e}.json${c}`,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),i("/QuickMart/authentication/login/success")),P=e=>async({request:a})=>{const t=await a.formData(),n=t.get("intent"),m=n==="login",g=n==="reset",w=n==="new password",h=n==="signup";let s,o=[`${r}.json${c}`],l;const p=await f(o);if((m||g)&&(s=await u(t,["email","password"])),w&&(s=await u(t,["password"]),o=[`${r}/user_${e}.json${c}`]),h){const j=Math.floor(Math.random()*100);s=await u(t,["fullName","email","password"]),!b(p.data,s).length>0?o=[`${r}/user_${j}.json${c}`,{method:a.method,headers:{"Content-Type":"application/json"},body:JSON.stringify({id:j,...s})}]:l="Account already exist"}const{data:$}=await f(...o);if(m)return d(D(p,s).length>0,i("/QuickMart"),"Invalid email or password");if(g)return d(b($,s).length!==0,i("/QuickMart/authentication/login/email verification"),"Invalid email");if(w)return d($.password!==s.password,v(e,a.method,s),"New password cannot be the same as your old password");if(h)return l?[{message:l},{status:401}]:i("/QuickMart/authentication/signup/email verification")};export{P as action};
